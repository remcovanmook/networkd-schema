import os
import argparse
import sys

# Reusing styles from generate_html.py for consistency
CSS_STYLES = """
:root {
    --bg-color: #0f111a;
    --text-color: #c9d1d9;
    --heading-color: #58a6ff;
    --link-color: #58a6ff;
    --code-bg: #161b22;
    --border-color: #30363d;
    --accent-color: #238636;
    --meta-color: #8b949e;
    --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: var(--bg-color);
    color: var(--text-color);
    font-family: var(--font-main);
    line-height: 1.6;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    min-height: 100vh;
}

.container {
    max-width: 800px;
    width: 100%;
    padding: 40px 20px;
}

h1 { 
    color: var(--heading-color); 
    border-bottom: 1px solid var(--border-color); 
    padding-bottom: 20px; 
    margin-bottom: 30px;
    text-align: center;
}

.hero {
    background: #151920;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 30px;
    margin-bottom: 40px;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
}

.hero h2 { margin-top: 0; color: #fff; }
.hero p { color: var(--meta-color); font-size: 1.1em; }

.btn {
    display: inline-block;
    background: var(--accent-color);
    color: #fff;
    padding: 12px 24px;
    border-radius: 6px;
    font-weight: bold;
    text-decoration: none;
    margin-top: 20px;
    transition: background 0.2s;
}
.btn:hover { background: #2ea043; text-decoration: none; }

.versions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.version-card {
    background: var(--code-bg);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 10px;
    text-align: center;
    transition: border-color 0.2s, transform 0.2s;
}
.version-card:hover { border-color: var(--link-color); transform: translateY(-2px); }
.version-card a { display: block; font-weight: bold; color: var(--text-color); text-decoration: none; }
.version-card a:hover { color: var(--heading-color); }

footer {
    margin-top: 50px;
    text-align: center;
    color: var(--meta-color);
    font-size: 0.9em;
    border-top: 1px solid var(--border-color);
    padding-top: 20px;
}
"""

def generate_index(output_dir, versions):
    # Sort versions: latest first (numeric descending)
    # Filter out 'latest' string if present in list to avoid dupe, but create specific card
    
    clean_versions = []
    for v in versions:
        if v == 'latest': continue
        if v.startswith('v'):
            clean_versions.append(v)
    
    # Sort descending
    try:
        clean_versions.sort(key=lambda x: int(x[1:]), reverse=True)
    except:
        clean_versions.sort(reverse=True) # Fallback lexicographical
        
    latest_ver = clean_versions[0] if clean_versions else "unknown"

    html = f"""<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Systemd Network Documentation</title>
    <style>{CSS_STYLES}</style>
</head>
<body>
    <div class="container">
        <h1>Systemd Network Documentation</h1>
        
        <div class="hero">
            <h2>Latest Documentation</h2>
            <p>Comprehensive reference manuals and JSON schemas for systemd version <strong>{latest_ver}</strong>.</p>
            <a href="latest/systemd.network.html" class="btn">Read Latest Docs ({latest_ver})</a>
        </div>

        <h3>All Versions</h3>
        <p>Documentation archives for previous systemd releases.</p>
        <div class="versions-grid">
            {''.join([f'<div class="version-card"><a href="{v}/systemd.network.html">{v}</a></div>' for v in clean_versions])}
        </div>
        
        <footer>
            <p>Generated by networkd-schema project.</p>
        </footer>
    </div>
</body>
</html>
"""
    
    with open(os.path.join(output_dir, "index.html"), "w") as f:
        f.write(html)
    print(f"Generated landing page at {os.path.join(output_dir, 'index.html')}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--out", required=True)
    parser.add_argument("--versions", nargs="+", required=True)
    args = parser.parse_args()
    
    generate_index(args.out, args.versions)
